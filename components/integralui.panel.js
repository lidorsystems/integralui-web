/*
  filename: integralui.panel.js
  version : 23.2.0
  Copyright Â© 2016-2023 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
import{c as css,h as html}from"../external/lit-element.js";import{c as classMap}from"../external/class-map.js";import{s as styleMap}from"../external/style-map.js";import IntegralUIBase from"./integralui.base.js";import{IntegralUIColorScheme,IntegralUIComponentAppearance,IntegralUITheme}from"./integralui.enums.js";import{iuiPanelDefaultStyle}from"../styles/default/integralui.panel.style.js";import{iuiPanelOfficeStyle}from"../styles/themes/office/integralui.panel.office.js";import{iuiPanelDarkStyle}from"../styles/color-schemes/dark/integralui.panel.dark.js";import{iuiPanelLightStyle}from"../styles/color-schemes/light/integralui.panel.light.js";import{iuiScrollBarStyle}from"../styles/default/integralui.scrollbar.style.js";import{iuiScrollBarOfficeStyle}from"../styles/themes/office/integralui.scrollbar.office.js";import{iuiScrollBarDarkStyle}from"../styles/color-schemes/dark/integralui.scrollbar.dark.js";import{iuiScrollBarLightStyle}from"../styles/color-schemes/light/integralui.scrollbar.light.js";import"./integralui.scrollbar.js";class IntegralUIPanel extends IntegralUIBase{_init(){super._init();this._isDraggable=!1;this._contentAlignPos={top:0,left:0};this._contentSize={width:0,height:0};this._ctrlPadding={top:0,right:0,bottom:0,left:0};this._currentContentAlignment={horizontal:"left",vertical:"top"};this._currentScrollAppearance=IntegralUIComponentAppearance.Static;this._currentScrollPos={x:0,y:0};this._maxScrollPos={x:0,y:0};this._isScrollActive=!1;this._isScrollVisible=!0;this._prevScrollPos={x:0,y:0};this._scrollBarSize={width:0,height:0};this._scrollLargeChange={x:0,y:0};this._scrollSize={width:0,height:0};this._currentScrollColorSchemeSettings=css``;this._currentScrollStyleSettings=iuiScrollBarStyle;this._generalClassName="iui-panel";this._scrollCornerClassName="iui-scrollbar-corner";this._currentControlStyleSettings=iuiPanelDefaultStyle;this._initStyle();this.updateLayout();this._resizeObserver=new ResizeObserver(e=>{if(e&&e.length>0&&e[0].contentRect){let t=!1;this._clientRect={width:e[0].contentRect.width,height:e[0].contentRect.height};if(this._clientRect.width!==this._prevClientRect.width){this._prevClientRect.width=this._clientRect.width;t=!0}if(this._clientRect.height!==this._prevClientRect.height){this._prevClientRect.height=this._clientRect.height;t=!0}if(t)this.updateLayout()}})}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback();if(this._resizeObserver)this._resizeObserver.disconnect();this._resetScrollAppearanceTimeout();this._resizeObserver=null}attributeChangedCallback(e,t,l){super.attributeChangedCallback(e,t,l)}static get properties(){return{allowDrag:{type:Boolean,attribute:"allow-drag",reflect:!0},contentAlignment:{type:Object,attribute:"content-alignment"},scrollAppearance:{attribute:"scroll-appearance",converter:{fromAttribute:e=>"dynamic"===(e=e.replace(/"|'/,"").replace(/"|'/,"")).toLowerCase()?IntegralUIComponentAppearance.Dynamic:IntegralUIComponentAppearance.Static,toAttribute:(e,t)=>e===IntegralUIComponentAppearance.Dynamic?"Dynamic":"Static"},reflect:!0}}}get allowDrag(){return this._isDraggable}set allowDrag(e){if(this._isDraggable!==e){const t=this._isDraggable;this._isDraggable=e;this.requestUpdate("allowDrag",t);this.update()}}get contentAlignment(){return this._currentContentAlignment}set contentAlignment(e){if(e){let t=!1;const l=this._currentContentAlignment;if(void 0!==e.horizontal&&this._currentContentAlignment.horizontal!==e.horizontal){this._currentContentAlignment.horizontal=e.horizontal;t=!0}if(void 0!==e.vertical&&this._currentContentAlignment.vertical!==e.vertical){this._currentContentAlignment.vertical=e.vertical;t=!0}if(t){this.requestUpdate("contentAlignment",l);this.updateLayout()}}}get scrollAppearance(){return this._currentScrollAppearance}set scrollAppearance(e){if(this._currentScrollAppearance!==e){const t=this._currentScrollAppearance;this._currentScrollAppearance=e;this._isScrollVisible=this._currentScrollAppearance===IntegralUIComponentAppearance.Dynamic?!1:!0;this.requestUpdate("scrollAppearance",t);this.updateLayout()}}_processUpdateLayout(){let e=this;return new Promise(t=>{if(e._isUpdateAllowed)setTimeout(function(){e._updateReferences();e._clientRect={width:e._elemRef.clientWidth,height:e._elemRef.clientHeight};e._ctrlPadding=e._commonService.getPadding(e._elemRef);e._contentSize=e._contentElem?{width:e._contentElem.offsetWidth,height:e._contentElem.offsetHeight}:{width:0,height:0};switch(e._currentContentAlignment.horizontal){case"center":e._contentAlignPos.left=e._ctrlPadding.left+Math.max(0,(e._clientRect.width-e._ctrlPadding.left-e._ctrlPadding.right-e._contentSize.width)/2);break;case"right":e._contentAlignPos.left=Math.max(0,e._clientRect.width-e._ctrlPadding.right-e._contentSize.width);break;default:e._contentAlignPos.left=e._ctrlPadding.left}switch(e._currentContentAlignment.vertical){case"middle":e._contentAlignPos.top=e._ctrlPadding.top+Math.max(0,(e._clientRect.height-e._ctrlPadding.top-e._ctrlPadding.bottom-e._contentSize.height)/2);break;case"bottom":e._contentAlignPos.top=Math.max(0,e._clientRect.height-e._ctrlPadding.bottom-e._contentSize.height);break;default:e._contentAlignPos.top=e._ctrlPadding.top}e._updateScrollSize();e.update();e._updateScrollSize();t()},1)})}async updateLayout(e){await this._processUpdateLayout();this.update()}_updateScrollSize(){let e=this;e._scrollSize={width:e._contentSize.width+(e._ctrlPadding.left+e._ctrlPadding.right)-e._clientRect.width,height:e._contentSize.height+(e._ctrlPadding.top+e._ctrlPadding.bottom)-e._clientRect.height};if(e.isVerScrollVisible())if(e._scrollSize.width>0&&e._currentScrollAppearance===IntegralUIComponentAppearance.Static)e._scrollSize.width+=16;if(e.isHorScrollVisible())if(e._scrollSize.height>0&&e._currentScrollAppearance===IntegralUIComponentAppearance.Static)e._scrollSize.height+=16;e._scrollSize.width=Math.max(0,e._scrollSize.width);e._scrollSize.height=Math.max(0,e._scrollSize.height);e._maxScrollPos={x:e._scrollSize.width,y:e._scrollSize.height};if(e._currentScrollPos.x>e._maxScrollPos.x)e._changeHorizontalScrollPos(e._maxScrollPos.x);if(e._currentScrollPos.y>e._maxScrollPos.y)e._changeVerticalScrollPos(e._maxScrollPos.y);e._scrollBarSize={width:e.isVerScrollVisible()?e._clientRect.width-14:e._clientRect.width,height:e.isHorScrollVisible()?e._clientRect.height-14:e._clientRect.height};if(e._currentScrollAppearance===IntegralUIComponentAppearance.Static){e._scrollBarSize.width-=4;e._scrollBarSize.height-=4}else{if(e.isVerScrollVisible())e._scrollBarSize.height+=2;if(e.isHorScrollVisible())e._scrollBarSize.width+=2;if(e.isVerScrollVisible()&&e.isHorScrollVisible()){e._scrollBarSize.width+=5;e._scrollBarSize.height+=5}}e._scrollLargeChange={x:e._scrollBarSize.width,y:e._scrollBarSize.height}}_ctrlMouseEnter(e){if(this._isEnabled){if(this._currentScrollAppearance===IntegralUIComponentAppearance.Dynamic)this._isScrollVisible=!0;this.update()}}_ctrlMouseLeave(e){if(this._isEnabled){if(this._currentScrollAppearance===IntegralUIComponentAppearance.Dynamic){this._resetScrollAppearanceTimeout();this._isScrollVisible=this._isScrollActive?!0:!1}this.update()}}_changeHorizontalScrollPos(e){this._currentScrollPos.x=Math.max(0,Math.min(e,this._maxScrollPos.x));if(this._currentScrollPos.x!==this._prevScrollPos.x){this._invokeEvent("scrollPosChanged",{value:this.scrollPos()});this._prevScrollPos.x=this._currentScrollPos.x;this.update()}}_changeVerticalScrollPos(e){this._currentScrollPos.y=Math.max(0,Math.min(e,this._maxScrollPos.y));if(this._currentScrollPos.y!==this._prevScrollPos.y){this._invokeEvent("scrollPosChanged",{value:this.scrollPos()});this._prevScrollPos.y=this._currentScrollPos.y;this.update()}}_processMouseWheel(e,t){if(this._isEnabled){e.preventDefault();let t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),l=5,i=0,r=0;if(e.shiftKey){i=Math.floor(this._clientRect.width/l);r=this._currentScrollPos.x+i*t*-1;this._changeHorizontalScrollPos(r)}else{i=Math.floor(this._clientRect.height/l);r=this._currentScrollPos.y+i*t*-1;this._changeVerticalScrollPos(r)}e.stopPropagation()}}scrollPos(e){if(e){this._currentScrollPos={x:Math.max(0,Math.min(e.x,this._maxScrollPos.x)),y:Math.max(0,Math.min(e.y,this._maxScrollPos.y))};this._invokeEvent("scrollPosChanged",{value:this._currentScrollPos})}return{x:Math.floor(this._currentScrollPos.x),y:Math.floor(this._currentScrollPos.y)}}isHorScrollVisible(){return this._isEnabled&&this._scrollSize.width>0?!0:!1}isVerScrollVisible(){return this._isEnabled&&this._scrollSize.height>0?!0:!1}_onHorizontalScrollStart(e){this._hoverItem=null;this._isScrollActive=!0}_onHorizontalScrollEnd(e){this._isScrollActive=!1}_onHorizontalScrollChanged(e){this._currentScrollPos.x=e.detail.value;this._invokeEvent("scrollPosChanged",{value:this.scrollPos()});this.update()}_onVerticalScrollStart(e){this._isScrollActive=!0}_onVerticalScrollEnd(e){this._isScrollActive=!1;this._updateScrollAppearance(e.detail.event)}_onVerticalScrollChanged(e){this._changeVerticalScrollPos(e.detail.value)}_updateScrollAppearance(e){let t=this;t._resetScrollAppearanceTimeout();t._scrollAppearanceTimeout=setTimeout(function(){let l=t._commonService.getPageRect(t._elemRef),i=t._commonService.getMousePos(e),r=t._commonService.getShiftPos();i.x-=r.x;i.y-=r.y;let s=i.x<l.left||i.x>l.right||i.y<l.top||i.y>l.bottom;t._isScrollVisible=s?!1:!0;t.update()},100)}_getScrollCornerClass(){let e={};e[this._scrollCornerClassName]=!0;if(this._currentScrollAppearance===IntegralUIComponentAppearance.Dynamic)e[this._scrollCornerClassName+"-dynamic"]=!0;if(!this._isEnabled)e[this._scrollCornerClassName+"-disabled"]=!0;return e}_updateColorSchemeSettings(e){this._currentColorSchemeSettings=css``;this._currentScrollColorSchemeSettings=css``;switch(e){case IntegralUIColorScheme.Dark:this._currentColorSchemeSettings.cssText=this._commonService.replaceAll(iuiPanelDarkStyle.cssText,"../../../icons",this._currentResourcePath);this._currentScrollColorSchemeSettings.cssText=this._commonService.replaceAll(iuiScrollBarDarkStyle.cssText,"../../../icons",this._currentResourcePath);break;case IntegralUIColorScheme.Light:this._currentColorSchemeSettings.cssText=this._commonService.replaceAll(iuiPanelLightStyle.cssText,"../../../icons",this._currentResourcePath);this._currentScrollColorSchemeSettings.cssText=this._commonService.replaceAll(iuiScrollBarLightStyle.cssText,"../../../icons",this._currentResourcePath);break;default:this._currentColorSchemeSettings.cssText="";this._currentScrollColorSchemeSettings.cssText=""}}_updateThemeSettings(e){this._currentThemeSettings=css``;this._currentScrollStyleSettings=css``;switch(e){case IntegralUITheme.Office:this._currentThemeSettings.cssText=this._commonService.replaceAll(iuiPanelOfficeStyle.cssText,"../../../icons",this._currentResourcePath);this._currentScrollStyleSettings.cssText=this._commonService.replaceAll(iuiScrollBarOfficeStyle.cssText,"../../../icons",this._currentResourcePath);break;default:this._currentThemeSettings.cssText="";this._currentScrollStyleSettings.cssText=this._commonService.replaceAll(iuiScrollBarStyle.cssText,"../../icons",this._currentResourcePath)}}_resetScrollAppearanceTimeout(){if(this._scrollAppearanceTimeout)clearTimeout(this._scrollAppearanceTimeout);this._scrollAppearanceTimeout=null}firstUpdated(e){this.updateLayout()}render(){return html`            <style>                ${iuiScrollBarStyle}                ${this._currentScrollStyleSettings}                ${this._currentControlStyleSettings}                ${this._currentThemeSettings}                ${this._currentColorSchemeSettings}                ${this._currentScrollColorSchemeSettings}                ${this._currentCustomStyle}            </style>            <div data-ctrl="panel" class=${classMap(this._getControlClass())} style=${styleMap(this._getControlStyle())} draggable="${this._isDraggable?!0:!1}" @DOMMouseScroll="${e=>this._processMouseWheel(e)}" @mousewheel="${e=>this._processMouseWheel(e)}" @mouseenter="${e=>this._ctrlMouseEnter(e)}" @mouseleave="${e=>this._ctrlMouseLeave(e)}">                <div id="content" style=${styleMap({position:"absolute",top:this._contentAlignPos.top-this._currentScrollPos.y+"px",left:this._contentAlignPos.left-this._currentScrollPos.x+"px"})}>                    <slot></slot>                </div>                ${this.isVerScrollVisible()?html`<iui-scrollbar id="ver-scroll" .allowAnimation="${this._isAnimationAllowed}" .appearance="${this._currentScrollAppearance}" .colorScheme="${this._currentColorScheme}" .enabled="${this.enabled}" .height="${this._scrollBarSize.height}" .largeChange="${this._scrollLargeChange.y}" .max="${this._maxScrollPos.y}" .theme="${this._currentTheme}" .value="${this._currentScrollPos.y}" .visible="${this._isScrollVisible}" @valueChanged="${e=>this._onVerticalScrollChanged(e)}" @scrollStart="${e=>this._onVerticalScrollStart(e)}" @scrollEnd="${e=>this._onVerticalScrollEnd(e)}"></iui-scrollbar>`:html``}                ${this.isHorScrollVisible()?html`<iui-scrollbar id="hor-scroll" .allowAnimation="${this._isAnimationAllowed}" .appearance="${this._currentScrollAppearance}" .colorScheme="${this._currentColorScheme}" .enabled="${this.enabled}" .largeChange="${this._scrollLargeChange.x}" .max="${this._maxScrollPos.x}" orientation="Horizontal" .theme="${this._currentTheme}" .value="${this._currentScrollPos.x}" .visible="${this._isScrollVisible}" .width="${this._scrollBarSize.width}" @valueChanged="${e=>this._onHorizontalScrollChanged(e)}" @scrollStart="${e=>this._onHorizontalScrollStart(e)}" @scrollEnd="${e=>this._onHorizontalScrollEnd(e)}"></iui-scrollbar>`:html``}                ${this.isVerScrollVisible()&&this.isHorScrollVisible()?html`<div class=${classMap(this._getScrollCornerClass())}></div>`:html``}            </div>        `}_updateControlStyleSettings(e){this._currentControlStyleSettings=css``;this._currentControlStyleSettings.cssText=this._commonService.replaceAll(iuiPanelDefaultStyle.cssText,"../../icons",e)}_updateReferences(){this._elemRef=this.shadowRoot.querySelector("div[data-ctrl=panel]");this._contentElem=this.shadowRoot.querySelector("#content");if(this._resizeObserver)this._resizeObserver.observe(this._elemRef)}}window.customElements.define("iui-panel",IntegralUIPanel);export default IntegralUIPanel;